<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>神経衰弱</title>
    <style>
        .card {
            height: 300px;
            width: 200px;
            /* border: 1px solid #aaa; */
            cursor: pointer;
        }
        .open {
            /* background-color: #eee; */
        }
        .close {
            background-image: url("trump/png/z01.png");
        }
    </style>
</head>
<body onload="init()">
    <!-- カード生成
        HTML
            id名：c01 クローバの１
            クラス名：card close
                開いたら card open
        データ
            number: c01
            open: false 裏向き
    生成したカードを配列に入れる
    シャッフルする -->

    <table id="field"></table>

    <script>
        const cards = [];
        const marks = ['s', 'c', 'h', 'd']; // スペード、クローバー、ハート、ダイヤ
        var flipedCard;
        var td;

        function init(){
            for(let i = 0; i < marks.length; i++){
                for(let j = 1; j < 14; j++){ // s01 〜 d13まで生成
                    var card = {
                        mark: marks[i] + ("0" + j).slice(-2),
                        number: j,
                        open: false
                    }
                    cards.push(card); // 連想配列
                }
            }
            shuffle();
            draw();
        }
        
        // 生成したカードをシャッフル
        function shuffle(){
            for(var i = cards.length - 1; i > 0; i--){
                var r = Math.floor(Math.random() * (i + 1));
                var tmp = cards[i];
                cards[i] = cards[r];
                cards[r] = tmp;
            }
            console.log(cards);
        }

        // DOMに書き出す
        function draw(){
            var field = document.getElementById("field");
            field.innerHTML = "";
            for (var i = 0; i < 4; i++){
                var tr = document.createElement("tr");
                for (var j = 0; j < 13; j++){
                    td = document.createElement("td");
                    var index = i * 13 + j;
                    var id = cards[index].mark; // シャッフルした配列から指定する
                    td.className = "card close";
                    td.id = id;
                    var src = 'trump/png/'+id+'.png';
                    td.index = src;
                    // td.style.backgroundImage = "url( trump/png/.png )";
                    // td.textContent = id;
                    td.number = cards[index].number;
                    td.onclick = click;
                    tr.appendChild(td);
                }
                field.appendChild(tr);
            }
        }

        function click(e){
            let firstCard = e.srcElement;
            let num = firstCard.number
            firstCard.className = 'card open';
            
            if(flipedCard == null){
                flipedCard = firstCard;
                firstCard.style.backgroundImage = "url(" + firstCard.index + ")";
                return;
            }
            // console.log(flipedCard.id, e.srcElement.id);
            // 同じカードを２回クリックしても反応しない
            if(flipedCard.id == e.srcElement.id){
                return;
            }
            if(flipedCard.number == num){ // ２枚のカードの数字が同じ場合
                // console.log(e.srcElement);
                e.srcElement.style.backgroundImage = "url(" + e.srcElement.index + ")";
                flipedCard = null;
            } else {
                e.srcElement.style.backgroundImage = "url(" + e.srcElement.index + ")";
                setTimeout(function () {
                    firstCard.style.backgroundImage = "url(trump/png/z01.png)";
                    flipedCard.style.backgroundImage = "url(trump/png/z01.png)";
                    flipedCard = null;
                }, 1000);
            }
        }
    </script>
</body>
</html>